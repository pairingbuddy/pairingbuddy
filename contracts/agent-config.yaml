# Agent configuration for agent architecture tests
# Single source of truth for agent structure validation

# =============================================================================
# JSON Schemas for state contracts
# =============================================================================
# Schema files live in contracts/schemas/
# test-config flows through all agents implicitly

schema_version: "http://json-schema.org/draft-07/schema#"

schemas:
  - task.schema.json
  - task-classification.schema.json
  - test-config.schema.json
  - scenarios.schema.json
  - tests.schema.json
  - current-batch.schema.json
  - test-state.schema.json
  - code-state.schema.json
  - issues.schema.json
  - files-changed.schema.json
  - coverage-report.schema.json
  - all-tests-results.schema.json
  - commit-result.schema.json
  - human-guidance.schema.json

# =============================================================================
# Agent definitions
# =============================================================================

agents:
  classify-task:
    color: cyan
    model: haiku
    skills: []
    inputs:
      task:
        schema: task.schema.json
        file: .pairingbuddy/task.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      task_classification:
        schema: task-classification.schema.json
        file: .pairingbuddy/task-classification.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Output"

  enumerate-scenarios-and-test-cases:
    color: magenta
    model: sonnet
    skills: [enumerating-tests]
    inputs:
      task:
        schema: task.schema.json
        file: .pairingbuddy/task.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      scenarios:
        schema: scenarios.schema.json
        file: .pairingbuddy/scenarios.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Human Review"
        content: human_review
      - heading: "## Output"

  create-test-placeholders:
    color: yellow
    model: haiku
    skills: [writing-tests]
    inputs:
      scenarios:
        schema: scenarios.schema.json
        file: .pairingbuddy/scenarios.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      tests:
        schema: tests.schema.json
        file: .pairingbuddy/tests.json
        optional: true
      coverage_report:
        schema: coverage-report.schema.json
        file: .pairingbuddy/coverage-report.json
        optional: true
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      tests:
        schema: tests.schema.json
        file: .pairingbuddy/tests.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Human Review"
        content: human_review
      - heading: "## Output"

  implement-tests:
    color: red
    model: haiku
    skills: [writing-tests]
    inputs:
      current_batch:
        schema: current-batch.schema.json
        file: .pairingbuddy/current-batch.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      test_state:
        schema: test-state.schema.json
        file: .pairingbuddy/test-state.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Output"

  implement-code:
    color: green
    model: sonnet
    skills: [writing-code]
    inputs:
      test_state:
        schema: test-state.schema.json
        file: .pairingbuddy/test-state.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      code_state:
        schema: code-state.schema.json
        file: .pairingbuddy/code-state.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Output"

  identify-test-issues:
    color: yellow
    model: haiku
    skills: [writing-tests]
    inputs:
      tests:
        schema: tests.schema.json
        file: .pairingbuddy/tests.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      test_issues:
        schema: issues.schema.json
        file: .pairingbuddy/test-issues.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Human Review"
        content: human_review
      - heading: "## Output"

  refactor-tests:
    color: magenta
    model: haiku
    skills: [writing-tests, refactoring-code]
    inputs:
      test_issues:
        schema: issues.schema.json
        file: .pairingbuddy/test-issues.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      files_changed:
        schema: files-changed.schema.json
        file: .pairingbuddy/files-changed.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Output"

  identify-code-issues:
    color: yellow
    model: haiku
    skills: [refactoring-code]
    inputs:
      code_state:
        schema: code-state.schema.json
        file: .pairingbuddy/code-state.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      code_issues:
        schema: issues.schema.json
        file: .pairingbuddy/code-issues.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Human Review"
        content: human_review
      - heading: "## Output"

  refactor-code:
    color: blue
    model: sonnet
    skills: [refactoring-code]
    inputs:
      code_issues:
        schema: issues.schema.json
        file: .pairingbuddy/code-issues.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      files_changed:
        schema: files-changed.schema.json
        file: .pairingbuddy/files-changed.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Output"

  verify-test-coverage:
    color: magenta
    model: sonnet
    skills: [writing-tests]
    inputs:
      scenarios:
        schema: scenarios.schema.json
        file: .pairingbuddy/scenarios.json
      tests:
        schema: tests.schema.json
        file: .pairingbuddy/tests.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      coverage_report:
        schema: coverage-report.schema.json
        file: .pairingbuddy/coverage-report.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Human Review"
        content: human_review
      - heading: "## Output"

  run-all-tests:
    color: green
    model: haiku
    skills: []
    inputs:
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      all_tests_results:
        schema: all-tests-results.schema.json
        file: .pairingbuddy/all-tests-results.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Output"

  commit-changes:
    color: magenta
    model: haiku
    skills: [committing-changes]
    inputs:
      files_changed:
        schema: files-changed.schema.json
        file: .pairingbuddy/files-changed.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      commit_result:
        schema: commit-result.schema.json
        file: .pairingbuddy/commit-result.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Output"

  scope-refactoring:
    color: cyan
    model: sonnet
    skills: [refactoring-code]
    inputs:
      task:
        schema: task.schema.json
        file: .pairingbuddy/task.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      code_issues:
        schema: issues.schema.json
        file: .pairingbuddy/code-issues.json
      test_issues:
        schema: issues.schema.json
        file: .pairingbuddy/test-issues.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
      - heading: "## Human Review"
        content: human_review
      - heading: "## Output"

# =============================================================================
# Human Review Configuration
# =============================================================================

human_review:
  content: |
    Before proceeding with implementation, pause and present your analysis to the human operator for review.

    - Use the AskUserQuestion tool to present your findings
    - Wait for explicit approval before proceeding
    - If the human operator requests changes:
      1. Revise your analysis accordingly
      2. Append their feedback to `.pairingbuddy/human-guidance.json`
      3. Ask again with the revised analysis

    When appending to human-guidance.json:
    - Read existing file first (or create with `{"guidance": []}` if missing)
    - Append a new entry capturing the essence of the feedback
    - Write the updated file

    Example guidance entry:
    ```json
    {
      "agent": "enumerate-scenarios-and-test-cases",
      "timestamp": "2025-12-15T10:30:00Z",
      "context": "reviewing proposed scenarios",
      "feedback": "Focus on core functionality, edge cases are out of scope"
    }
    ```

    Only append when the human provides corrections or guidance. Simple approvals ("looks good", "proceed") do not need to be recorded.

    Example interaction:

    ```
    AskUserQuestion: "I've identified the following items for processing:
    - Item 1: [description]
    - Item 2: [description]

    Should I proceed with this approach?"
    ```
