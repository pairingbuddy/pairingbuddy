# Agent configuration for agent architecture tests
# Single source of truth for agent structure validation

# =============================================================================
# JSON Schemas for state contracts
# =============================================================================
# Schema files live in contracts/schemas/
# test-config flows through all agents implicitly

schema_version: "http://json-schema.org/draft-07/schema#"

schemas:
  - task.schema.json
  - task-classification.schema.json
  - test-config.schema.json
  - scenarios.schema.json
  - tests.schema.json
  - current-batch.schema.json
  - test-state.schema.json
  - code-state.schema.json
  - issues.schema.json
  - files-changed.schema.json
  - coverage-report.schema.json
  - all-tests-results.schema.json
  - commit-result.schema.json
  - human-guidance.schema.json
  - spike-config.schema.json
  - spike-questions.schema.json
  - spike-findings.schema.json
  - spike-summary.schema.json
  - current-unit.schema.json
  - doc-config.schema.json
  - docs-updated.schema.json

# =============================================================================
# Agent definitions
# =============================================================================

agents:
  curate-guidance:
    color: cyan
    model: sonnet
    skills: []
    inputs:
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
      task:
        schema: task.schema.json
        file: .pairingbuddy/task.json
        optional: true
    outputs:
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  classify-task:
    color: cyan
    model: haiku
    skills: []
    inputs:
      task:
        schema: task.schema.json
        file: .pairingbuddy/task.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      task_classification:
        schema: task-classification.schema.json
        file: .pairingbuddy/task-classification.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "## Output"

  enumerate-scenarios-and-test-cases:
    color: magenta
    model: sonnet
    skills: [enumerating-tests]
    inputs:
      task:
        schema: task.schema.json
        file: .pairingbuddy/task.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      scenarios:
        schema: scenarios.schema.json
        file: .pairingbuddy/scenarios.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  create-test-placeholders:
    color: yellow
    model: haiku
    skills: [writing-tests]
    inputs:
      scenarios:
        schema: scenarios.schema.json
        file: .pairingbuddy/scenarios.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      tests:
        schema: tests.schema.json
        file: .pairingbuddy/tests.json
        optional: true
      coverage_report:
        schema: coverage-report.schema.json
        file: .pairingbuddy/coverage-report.json
        optional: true
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      tests:
        schema: tests.schema.json
        file: .pairingbuddy/tests.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  implement-tests:
    color: red
    model: haiku
    skills: [writing-tests]
    inputs:
      current_batch:
        schema: current-batch.schema.json
        file: .pairingbuddy/current-batch.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      test_state:
        schema: test-state.schema.json
        file: .pairingbuddy/test-state.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "## Output"

  implement-code:
    color: green
    model: sonnet
    skills: [writing-code]
    inputs:
      test_state:
        schema: test-state.schema.json
        file: .pairingbuddy/test-state.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      code_state:
        schema: code-state.schema.json
        file: .pairingbuddy/code-state.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "## Output"

  identify-test-issues:
    color: yellow
    model: haiku
    skills: [writing-tests]
    inputs:
      tests:
        schema: tests.schema.json
        file: .pairingbuddy/tests.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      test_issues:
        schema: issues.schema.json
        file: .pairingbuddy/test-issues.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  refactor-tests:
    color: magenta
    model: haiku
    skills: [writing-tests, refactoring-code]
    inputs:
      test_issues:
        schema: issues.schema.json
        file: .pairingbuddy/test-issues.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      files_changed:
        schema: files-changed.schema.json
        file: .pairingbuddy/files-changed.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "## Output"

  identify-code-issues:
    color: yellow
    model: haiku
    skills: [refactoring-code]
    inputs:
      code_state:
        schema: code-state.schema.json
        file: .pairingbuddy/code-state.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      code_issues:
        schema: issues.schema.json
        file: .pairingbuddy/code-issues.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  refactor-code:
    color: blue
    model: sonnet
    skills: [refactoring-code]
    inputs:
      code_issues:
        schema: issues.schema.json
        file: .pairingbuddy/code-issues.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      files_changed:
        schema: files-changed.schema.json
        file: .pairingbuddy/files-changed.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "## Output"

  verify-test-coverage:
    color: magenta
    model: sonnet
    skills: [writing-tests]
    inputs:
      scenarios:
        schema: scenarios.schema.json
        file: .pairingbuddy/scenarios.json
      tests:
        schema: tests.schema.json
        file: .pairingbuddy/tests.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      coverage_report:
        schema: coverage-report.schema.json
        file: .pairingbuddy/coverage-report.json
    sections:
      - heading: "## Purpose"
      - heading: "## Definitions"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  run-all-tests:
    color: green
    model: haiku
    skills: []
    inputs:
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      all_tests_results:
        schema: all-tests-results.schema.json
        file: .pairingbuddy/all-tests-results.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "## Output"

  update-documentation:
    color: cyan
    model: sonnet
    skills: []
    inputs:
      files_changed:
        schema: files-changed.schema.json
        file: .pairingbuddy/files-changed.json
      doc_config:
        schema: doc-config.schema.json
        file: .pairingbuddy/doc-config.json
      task:
        schema: task.schema.json
        file: .pairingbuddy/task.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      docs_updated:
        schema: docs-updated.schema.json
        file: .pairingbuddy/docs-updated.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  commit-changes:
    color: magenta
    model: haiku
    skills: [committing-changes]
    inputs:
      files_changed:
        schema: files-changed.schema.json
        file: .pairingbuddy/files-changed.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      commit_result:
        schema: commit-result.schema.json
        file: .pairingbuddy/commit-result.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "## Output"

  scope-refactoring:
    color: cyan
    model: sonnet
    skills: [refactoring-code]
    inputs:
      task:
        schema: task.schema.json
        file: .pairingbuddy/task.json
      test_config:
        schema: test-config.schema.json
        file: .pairingbuddy/test-config.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      code_issues:
        schema: issues.schema.json
        file: .pairingbuddy/code-issues.json
      test_issues:
        schema: issues.schema.json
        file: .pairingbuddy/test-issues.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  setup-spike:
    color: cyan
    model: sonnet
    skills: []
    inputs:
      task:
        schema: task.schema.json
        file: .pairingbuddy/task.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      spike_config:
        schema: spike-config.schema.json
        file: .pairingbuddy/spike-config.json
      spike_questions:
        schema: spike-questions.schema.json
        file: .pairingbuddy/spike-questions.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  explore-spike-unit:
    color: blue
    model: sonnet
    skills: []
    inputs:
      spike_config:
        schema: spike-config.schema.json
        file: .pairingbuddy/spike-config.json
      spike_questions:
        schema: spike-questions.schema.json
        file: .pairingbuddy/spike-questions.json
      current_unit:
        schema: current-unit.schema.json
        file: .pairingbuddy/current-unit.json
      spike_findings:
        schema: spike-findings.schema.json
        file: .pairingbuddy/spike-findings.json
        optional: true
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      spike_findings:
        schema: spike-findings.schema.json
        file: .pairingbuddy/spike-findings.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

  document-spike:
    color: green
    model: sonnet
    skills: []
    inputs:
      spike_config:
        schema: spike-config.schema.json
        file: .pairingbuddy/spike-config.json
      spike_findings:
        schema: spike-findings.schema.json
        file: .pairingbuddy/spike-findings.json
      human_guidance:
        schema: human-guidance.schema.json
        file: .pairingbuddy/human-guidance.json
        optional: true
    outputs:
      spike_summary:
        schema: spike-summary.schema.json
        file: .pairingbuddy/spike-summary.json
    sections:
      - heading: "## Purpose"
      - heading: "## Input"
      - heading: "## Instructions"
        content: focus_warning
      - heading: "### Step 1: Read Inputs"
        content: workflow_read_inputs
      - heading: "### Step 2: Main Work"
      - heading: "### Step 3: Human Review"
        content: workflow_step3_human_review
      - heading: "### Step 4: Output"
        content: workflow_step4_output
      - heading: "## Output"

# =============================================================================
# Shared Content Blocks
# =============================================================================

focus_warning:
  content: |
    **CRITICAL: Stay laser-focused. Do ONLY what is described below - nothing more. Do not anticipate next steps or do work that belongs to other agents.**

# =============================================================================
# Workflow Pattern for Agents with Human Review
# =============================================================================
# Agents with human review follow this workflow:
#   1. Read inputs (including human-guidance.json)
#   2. Do main work
#   3. Human review (present to human)
#   4. If feedback: append to human-guidance.json, go to step 2
#   5. If approve/terminate: write output

workflow_read_inputs:
  content: |
    Read all input files listed above, including `.pairingbuddy/human-guidance.json`.
    Apply any guidance from prior agents to avoid repeating mistakes or assumptions.

workflow_step3_human_review:
  content: |
    Present your analysis to the human operator for review using AskUserQuestion.

    **Review loop:**
    1. Present findings and ask for approval
    2. If human provides corrections or feedback:
       a. **IMMEDIATELY** append to `.pairingbuddy/human-guidance.json` (before anything else)
       b. Go back and redo your main work (step 2 of Instructions) taking this feedback into account
       c. Present revised analysis and ask again (return to step 1 of this loop)
    3. Only exit the loop when human either:
       - Explicitly approves (e.g., "yes", "proceed", "looks good")
       - Explicitly terminates (e.g., "stop", "skip", "cancel")

    **Do NOT proceed to output after receiving feedback** - always redo analysis and ask again.

    When appending to human-guidance.json:
    - Read existing file first (or create with `{"guidance": []}` if missing)
    - Append a new entry capturing the essence of the feedback
    - Write the updated file

    Example guidance entry:
    ```json
    {
      "agent": "enumerate-scenarios-and-test-cases",
      "timestamp": "2025-12-15T10:30:00Z",
      "context": "reviewing proposed scenarios",
      "feedback": "Focus on core functionality, edge cases are out of scope"
    }
    ```

    Only append when the human provides corrections or guidance. Simple approvals ("looks good", "proceed") do not need to be recorded.

    Example interaction:

    ```
    AskUserQuestion: "I've identified the following items for processing:
    - Item 1: [description with all relevant details]
    - Item 2: [description with all relevant details]

    Should I proceed with this approach?"
    ```

    **Important:** Descriptions must include ALL relevant details the human needs to make an informed decision. Do not use generic placeholders - provide specific names, configurations, file paths, or other context-specific information so the human can validate your analysis.

workflow_step4_output:
  content: |
    **MANDATORY: You MUST write to ALL output files listed in the Output section before completing.**

    After approval, write output using this procedure for EACH output file:

    1. **Determine write mode** from the Output section:
       - "Writes to" = create/overwrite the file with your complete results
       - "Appends to" = read existing file first, add your new entries to the array, write back
       - "Updates" = read existing file first, modify entries as needed, write back

    2. **For append/update modes:** Read the existing file (use Read tool). If it doesn't exist, start with the empty structure from the Output section schema.

    3. **Write** the complete JSON to the output file (use Write tool)

    **Completion requirements:**
    - You are NOT done until ALL output files are written
    - Do not exit, do not report completion, do not hand off to the next agent until every file listed in Output is written
    - Verify each file was written by reading it back if unsure

    **NEVER use bash commands (echo, cat, printf, heredoc, etc.) to write JSON files.** Always use the Write tool.
